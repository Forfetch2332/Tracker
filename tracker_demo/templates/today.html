{% extends "layout.html" %}
{% block content %}

<h3>Сегодня</h3>

{% if show_done_alert %}
<div class="alert alert-success">
    Практика успешно выполнена!
</div>
{% endif %}

<!-- Прогресс дня -->
<div class="mb-4">

    <p class="text-muted mb-1">
        Выполнено {{ done }} из {{ total }} ({{ percent }}%)
    </p>

    <div class="progress" style="height: 22px;">

        {% set bar_class = "" %}
        {% if percent < 40 %}
            {% set bar_class = "bg-danger" %}
        {% elif percent < 70 %}
            {% set bar_class = "bg-warning" %}
        {% else %}
            {% set bar_class = "bg-success" %}
        {% endif %}

        <div id="progress-bar"
             class="progress-bar {{ bar_class }}"
             role="progressbar"
             style="width: 0%;">
            {{ percent }}%
        </div>

    </div>

</div>

<!-- Список практик -->
<div class="row">

    {% for practice in practices %}
    <div class="col-md-6">

        {% set card_style = "" %}
        {% if practice.id in done_practice_ids %}
            {% set card_style = "opacity: 0.55;" %}
        {% endif %}

        <div class="card mb-3 shadow-sm" style="{{ card_style }}">

            <div class="card-body d-flex align-items-center justify-content-between">

                <div>
                    <h5 class="card-title mb-1">{{ practice.title }}</h5>
                </div>

                <div>
                    {% if practice.id in done_practice_ids %}
                        <span class="text-success" style="font-size: 1.8rem;">
                            ✓
                        </span>
                    {% else %}
                        <span class="text-secondary" style="font-size: 1.8rem;">
                            ○
                        </span>
                    {% endif %}
                </div>

            </div>

            <div class="card-body pt-0">

                {% if practice.id in done_practice_ids %}
                    <span class="badge bg-success">Выполнено</span>
                {% else %}
                    <a href="{{ url_for('practice_form', practice_id=practice.id) }}"
                       class="btn btn-primary">
                        Выполнить
                    </a>
                {% endif %}

            </div>

        </div>
    </div>
    {% endfor %}

</div>

<!-- Анимация прогресс-бара -->
<script>
    window.addEventListener("load", function () {
        const bar = document.getElementById("progress-bar");
        if (bar) {
            const target = {{ percent }};
            setTimeout(() => {
                bar.style.transition = "width 1.2s ease";
                bar.style.width = target + "%";
            }, 150);
        }
    });
</script>

{% endblock %}
