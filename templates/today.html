{% extends "layout.html" %}

{% block content %}
<div class="container py-4">

    <h2 class="mb-4 fw-bold">Практики на сегодня</h2>

    <div class="row g-4">

        {% for practice in practices %}
        <div class="col-md-6 col-lg-4">
            <div class="card shadow-sm border-0 h-100">

                <div class="card-body d-flex flex-column">

                    <h5 class="card-title fw-semibold" style="color: {{ practice.color }};">
                        {{ practice.title }}
                    </h5>

                    <p class="text-muted small flex-grow-1">
                        {{ practice.description[:120] }}...
                    </p>

                    <!-- Кнопка выполнения (AJAX) -->
                    <button
                        class="btn
                            {% if statuses.get(practice.id) %}
                                btn-success
                            {% else %}
                                btn-outline-secondary
                            {% endif %}
                            w-100 toggle-btn"

                        data-practice-id="{{ practice.id }}"
                        data-completed="{% if statuses.get(practice.id) %}1{% else %}0{% endif %}"
                    >
                        {% if statuses.get(practice.id) %}
                            ✅ Выполнено
                        {% else %}
                            ○ Отметить выполнение
                        {% endif %}
                    </button>

                    <!-- Streak -->
                    <div class="mt-2 small streak-block" id="streak-{{ practice.id }}">
                        {% if statuses.get(practice.id) %}
                            <span class="text-success">Серия: {{ statuses.get(practice.id).streak }} дней</span>
                        {% endif %}
                    </div>

                    <!-- Прогресс 14 дней -->
                    <div class="progress mt-2" style="height: 6px;">
                        <div
                            class="progress-bar bg-success progress-14"
                            id="progress-14-{{ practice.id }}"
                            role="progressbar"
                            style="width: {% if statuses.get(practice.id) %}{{ statuses.get(practice.id).progress_14 }}{% else %}0{% endif %}%;">
                        </div>
                    </div>

                    <div class="small text-muted mt-1" id="progress-text-14-{{ practice.id }}">
                        {% if statuses.get(practice.id) %}
                            Прогресс 14 дней: {{ statuses.get(practice.id).progress_14 }}%
                        {% else %}
                            Прогресс 14 дней: 0%
                        {% endif %}
                    </div>

                </div>

            </div>
        </div>
        {% endfor %}

    </div>

</div>

<!-- Подключим JS для AJAX -->
<script src="{{ url_for('static', filename='js/today.js') }}"></script>

{% endblock %}
