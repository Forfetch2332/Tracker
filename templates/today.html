{% extends "layout.html" %}

{% block content %}
<div class="container py-4">

    <h2 class="mb-4 fw-bold">Практики на сегодня</h2>

    <div class="row g-4">

        {% for practice in practices %}
        <div class="col-md-6 col-lg-4">
            <div class="card shadow-sm border-0 h-100">

                <div class="card-body d-flex flex-column">

                    <h5 class="card-title fw-semibold" style="color: {{ practice.color }};">
                        {{ practice.title }}
                    </h5>

                    <p class="text-muted small flex-grow-1">
                        {{ practice.description[:120] }}...
                    </p>

                    <!-- Кнопка выполнения -->
                    <form method="post"
                          action="{{ url_for('toggle_practice', pid=practice.id) }}"
                          class="mt-auto">

                        <button class="btn
                            {% if statuses.get(practice.id) %}
                                btn-success
                            {% else %}
                                btn-outline-secondary
                            {% endif %}
                            w-100">

                            {% if statuses.get(practice.id) %}
                                ✅ Выполнено
                            {% else %}
                                ○ Отметить выполнение
                            {% endif %}
                        </button>

                    </form>

                    <!-- Streak -->
                    {% if statuses.get(practice.id) %}
                        <div class="mt-2 text-success small">
                            Серия: {{ statuses.get(practice.id).streak }} дней
                        </div>

                        <!-- Прогресс 14 дней -->
                        <div class="progress mt-2" style="height: 6px;">
                            <div class="progress-bar bg-success"
                                 role="progressbar"
                                 style="width: {{ statuses.get(practice.id).progress_14 }}%;">
                            </div>
                        </div>

                        <div class="small text-muted mt-1">
                            Прогресс 14 дней: {{ statuses.get(practice.id).progress_14 }}%
                        </div>
                    {% endif %}

                </div>

            </div>
        </div>
        {% endfor %}

    </div>

</div>
{% endblock %}
